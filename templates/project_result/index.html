{% extends "layout.html" %}
{% from "_formhelpers.html" import render_field %}
{% block title %}実績一覧{% endblock %}
{% block include_css %}
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/icheck-1.0.2/skins/all.css') }}">
{% endblock %}
{% block include_js %}
  <!-- iCheck 1.0.2 -->
  <script src="{{ url_for('static', filename='vendor/icheck-1.0.2/icheck.js') }}"></script>
{% endblock %}
{% block content_header %}
  <h1>
    <a href="{{ url_for('project.index') }}" class="btn btn-default">
        <i class="fa fa-arrow-left"></i> 一覧に戻る
    </a>
  </h1>
{% endblock %}
{% block main_content %}
<div class="row">
  <div class="col-lg-9">
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title">
          {% if project.project_name %}{{ project.project_name }}
          <small> 見積No : {{ project.estimation_no|filter_suppress_none }}</small>
          {% endif %}
        </h3>
        <div class="box-tools">
          <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        <div class="nav-tabs-custom">
          <ul class="nav nav-tabs">
            <li><a href="{{ url_for('contract.index', project_id=project.id) }}">契約</a></li>
            <li class="active"><a href="#">実績</a></li>
            <li><a href="#">請求</a></li>
            <li><a href="#">支払</a></li>
          </ul>
          <div class="tab-content">

          {% for datum in form_data %}

            <div class="box box-success">
              <div class="box-header with-border">
                <h3 class="box-title"><i class="fa fa-edit"></i> {{ datum.month|datetime_format("%Y年%m月") }}</h3>

                <div class="box-tools pull-right">
                  <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-plus"></i></button>
                </div>
              </div>
              <!-- /.box-header -->
              <div class="box-body">
                <div class="form-group no-margin">
                  <label class="flag-label">
                    <input type="checkbox" id="{{ datum.project_month_id }}" name="billing_input_flag" />
                    <span style="padding-left: 5px; vertical-align: middle;">実績入力済み</span>
                  </label>
                </div>
                <div class="table-responsive no-padding">
                  <table class="table table-hover">
                    <tr>
                      <th width="250px">会社名称</th>
                      <th width="180px">技術者名</th>
                      <th class="text-right">実稼働時間</th>
                      <th class="text-right">請求確定金額</th>
                      <th class="text-right">支払確定金額</th>
                      <th width="50px" class="center"></th>
                      <th width="50px" class="center"></th>
                    </tr>
                    {% for project_result in datum.project_results %}
                      <tr>
                        <td>{{ project_result.project_detail.engineer.company.company_name|filter_suppress_none }}</td>
                        <td>{{ project_result.project_detail.engineer.engineer_name|filter_suppress_none }}</td>
                        <td class="text-right">{{ project_result.work_time|filter_suppress_none }}</td>
                        <td class="text-right">&yen{{ project_result.billing_confirmation_money|number_with_commas }}</td>
                        <td class="text-right">&yen{{ project_result.payment_confirmation_money|number_with_commas }}</td>
                      </tr>
                    {% endfor %}
                  </table>
                </div>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->
          {% endfor %}
          </div>
          <!-- ./tab-content -->
        </div>
        <!-- /.nav-tabs-custom -->
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.col -->

  {% if project.id %}
  <div class="col-lg-3">
    <div class="box box-success">
      <div class="box-header with-border">
        <h3 class="box-title"><i class="icon-paper-clip"></i> 添付</h3>

        <div class="box-tools">
          <button type="button" class="btn btn-box-tool" data-widget="collapse">
              <i class="fa fa-minus"></i>
          </button>
        </div>
      </div>
      <!-- /.box-header -->
      <div class="box-body">
        {% for attachment in project_attachments %}
          <strong><i class="fa fa-file-text-o fa-fw"></i> {{ attachment.type }}</strong>
          <div class="table-responsive no-padding">
            <table class="table small no-margin">
              {% for project_attachment in attachment.attachments %}
              <tr>
              <td width="20px" style="padding-right: 0;">
                <a style="font-size: xx-small;" href="{{ url_for('project_attachment.detail', project_attachment_id=project_attachment.id) }}">
                    <i class="fa fa-edit"></i>
                </a>
              </td>
              <td width="100px">
                  <a href="{{ url_for('attachment.download', attachment_id = project_attachment.attachment_id) }}">
                      {{ project_attachment.attachment.filename }}
                  </a>
              </td>
              <td>{{ project_attachment.remarks|filter_suppress_none }}</td>
              <td width="20px" style="padding-right: 0;">
                <a class="" style="font-size: xx-small;" href="{{ url_for('project_attachment.delete', project_attachment_id=project_attachment.id) }}">
                  <i class="fa fa-trash"></i>
                </a>
              </td>
              </tr>
             {% endfor %}
            </table>
          </div>
          <hr style="margin-top: 0;" />
        {% endfor %}
        <div class="footer">
          <a href="{{ url_for('project_attachment.create', project_id=project.id, _external=True) }}" class="btn btn-sm btn-default pull-right">
              <i class="fa fa-file-text-o"></i> ファイル添付画面
          </a>
        </div>
      </div>
      <!-- /.box-body -->
    </div>
    <!-- /.box -->
  </div>
  <!-- /.col -->
  {% endif %}
</div>
<!-- /.row -->
{% endblock %}
